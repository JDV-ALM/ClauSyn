<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="res_config_settings_view_form_bcv" model="ir.ui.view">
        <field name="name">res.config.settings.view.form.inherit.bcv</field>
        <field name="model">res.config.settings</field>
        <field name="inherit_id" ref="currency_rate_live.res_config_settings_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='currency_next_execution_date']/.." position="after">
                <div class="row mt16" invisible="currency_provider != 'bcv'">
                    <div class="col-12">
                        <h3>Configuraci贸n BCV - Banco Central de Venezuela</h3>
                        
                        <group>
                            <group string="Opciones de Actualizaci贸n">
                                <field name="can_update_habil_days" widget="boolean_toggle"/>
                                <div class="text-muted" colspan="2">
                                    <i class="fa fa-info-circle"/> Si est谩 activo, las tasas solo se actualizar谩n de lunes a viernes
                                </div>
                                
                                <field name="bcv_weekend_use_monday" widget="boolean_toggle"/>
                                <div class="text-muted" colspan="2">
                                    <i class="fa fa-info-circle"/> El BCV publica los viernes en la noche la tasa del lunes.
                                    Si activa esta opci贸n, las operaciones del s谩bado y domingo usar谩n esa tasa.
                                    <br/>
                                    <strong>Nota:</strong> Esto es 煤til para contabilizar operaciones del fin de semana con la tasa oficial del lunes.
                                </div>
                            </group>
                            
                            <group string="Estado del Servicio">
                                <field name="bcv_last_update" invisible="not bcv_last_update" widget="datetime"/>
                                <field name="bcv_last_error" invisible="not bcv_last_error" 
                                       widget="text" class="text-danger" colspan="2"/>
                            </group>
                        </group>
                        
                        <group>
                            <div class="mt8">
                                <button name="action_bcv_test_connection" 
                                        type="object" 
                                        string=" Probar Conexi贸n" 
                                        class="btn-secondary me-2"
                                        title="Verificar conexi贸n con el sitio del BCV"/>
                                <button name="action_bcv_update_now" 
                                        type="object" 
                                        string=" Actualizar Ahora" 
                                        class="btn-primary"
                                        title="Ejecutar actualizaci贸n manual de tasas"
                                        confirm="驴Actualizar las tasas del BCV ahora? Esto crear谩 tasas para hoy y, si est谩 en fin de semana con la opci贸n activada, tambi茅n para el lunes."/>
                            </div>
                        </group>
                        
                        <div class="alert alert-info mt16" role="alert">
                            <h4 class="alert-heading"><i class="fa fa-lightbulb-o"/> Informaci贸n Importante</h4>
                            <ul class="mb-0">
                                <li><strong>Horario de actualizaci贸n:</strong> El cron se ejecuta diariamente a las 8:30 AM (hora de Venezuela)</li>
                                <li><strong>Monedas soportadas:</strong> USD y EUR desde el BCV</li>
                                <li><strong>Monedas base compatibles:</strong> VES, VEF, USD</li>
                                <li><strong>Logs:</strong> Buscar con prefijo [BCV] en los logs del servidor</li>
                                <li><strong>Fin de semana:</strong> El BCV no actualiza tasas s谩bados y domingos, pero publica el viernes la tasa del lunes</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </xpath>
        </field>
    </record>

    <!-- Acci贸n de servidor para actualizaci贸n manual -->
    <record id="action_server_bcv_update" model="ir.actions.server">
        <field name="name">BCV: Actualizar Tasas Manualmente</field>
        <field name="model_id" ref="base.model_res_company"/>
        <field name="state">code</field>
        <field name="code">
records = env['res.company'].search([('currency_provider', '=', 'bcv')])
if records:
    records.bcv_update_currency_rates()
        </field>
    </record>
</odoo>
